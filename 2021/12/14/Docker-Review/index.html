

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.png">
  <link rel="icon" href="/img/icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Lucheng">
  <meta name="keywords" content="">
  
    <meta name="description" content="Docker Review Note">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker Review">
<meta property="og:url" content="http://example.com/2021/12/14/Docker-Review/index.html">
<meta property="og:site_name" content="Deer City">
<meta property="og:description" content="Docker Review Note">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/index/docker.png">
<meta property="article:published_time" content="2021-12-15T03:40:00.000Z">
<meta property="article:modified_time" content="2023-08-12T20:47:24.326Z">
<meta property="article:author" content="Lucheng">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/index/docker.png">
  
  
  <title>Docker Review - Deer City</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Deer City | Lucheng&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Docker Review">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-12-14 19:40" pubdate>
        December 14, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.5k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      22 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> views
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Docker Review</h1>
            
            <div class="markdown-body">
              <p>Docker Review Note</p>
<span id="more"></span>
<h1 id="Docker-Review"><a class="header-anchor" href="#Docker-Review">¶</a>Docker Review</h1>
<h1 id="Why-docker"><a class="header-anchor" href="#Why-docker">¶</a>Why docker?</h1>
<p>webserver → DB → messaging → orchestration</p>
<ol>
<li>the architecture of these components are varying over time!</li>
<li>setting environment is painful!</li>
<li>development team members have different OS environment</li>
</ol>
<ul>
<li>Container utilize the same OS Kernel (handling with hardware), which differs from VM</li>
</ul>
<p><img src="https://raw.githubusercontent.com/q815101630/pic_storage/main/img/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p>
<h1 id="Commands"><a class="header-anchor" href="#Commands">¶</a>Commands</h1>
<p>some Commands I don’t know:</p>
<ul>
<li><code>docker pull &lt;image&gt;</code> only pull image from DockerHub to local</li>
<li><code>docker exec &lt;container name&gt; &lt;command&gt;</code></li>
<li><code>docker run -d</code>   run in detach</li>
<li><code>docker run -it centos bash</code> run a base image and gets into bash</li>
<li><code>docker attach &lt;container name&gt;</code> run some detached app in foreground</li>
</ul>
<h1 id="Run"><a class="header-anchor" href="#Run">¶</a>Run</h1>
<ul>
<li><code>docker run redis:4.0</code>  specify a tag</li>
<li><code>docker run -it</code> runs interactively with terminal</li>
<li><code>docker run -v /opt/datadir:/var/lib/mysql mysql</code> mount volume</li>
<li><code>docker logs &lt;container name&gt;</code>  logs out the container status</li>
<li><code>docker run ubuntu cat /etc/*release*</code> run a command of a ubuntu image and exit container</li>
<li><code>docker attach &lt;container name&gt;</code>   pull a container to foreground</li>
<li><code>docker build &lt;Dockerfile name&gt; -t &lt;xxx/xxxx&gt;</code> build an image</li>
<li><code>docker push &lt;xxx/xxx&gt;</code> push a docker image to dockerhub</li>
<li><code>cat &gt; Dockerfile</code> input to a file <code>Dockerfile</code></li>
<li><code>docker run -e &lt;ENV NAME&gt;=&lt;ENV VALUE&gt; &lt;image name&gt;</code>  set a environement variable</li>
<li><code>docker inspect &lt;container name&gt;</code></li>
</ul>
<h1 id="CMD-V-S-Entrypoint"><a class="header-anchor" href="#CMD-V-S-Entrypoint">¶</a>CMD V.S Entrypoint</h1>
<p><code>CMD</code> simply refers to run a command</p>
<p><code>ENTRYPOINT</code> allows us to append further params to <code>CMD</code>!</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs jsx">FROM Ubuntu<br>ENTRYPOINT [<span class="hljs-string">&quot;sleep&quot;</span>]<br>CMD [<span class="hljs-string">&quot;5&quot;</span>]<br></code></pre></td></tr></table></figure>
<p><code>ENTRYPOINT</code> means that the user can interrupt the flow of <code>Dockerfile</code> and input some params into it.</p>
<p>We can also overwrite ENTRYPOINT by <code>--entrypoint</code> in <code>docker run</code></p>
<h1 id="Compose"><a class="header-anchor" href="#Compose">¶</a>Compose</h1>
<p>If we do not want Docker to pull images from dockerhub, we can replace <code>image</code>  to <code>build</code> in <code>docker-compose.yml</code> so that it knows to build the image from local</p>
<p><img src="https://raw.githubusercontent.com/q815101630/pic_storage/main/img/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p>
<h1 id="Docker-engine"><a class="header-anchor" href="#Docker-engine">¶</a>Docker engine</h1>
<p>Docker engine is composed of :</p>
<ol>
<li>Docker CLI</li>
<li>REST API</li>
<li>Docker Deamon</li>
</ol>
<p>Docker uses namespace to differentiate main system and child system</p>
<p><img src="https://raw.githubusercontent.com/q815101630/pic_storage/main/img/Untitled%202.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p>
<h2 id="cgroups"><a class="header-anchor" href="#cgroups">¶</a>cgroups</h2>
<p>cgroups can be used to ensure the limit of CPU usages</p>
<p><code>docker run --cpus=0.5 ubuntu</code></p>
<p><code>docker run --memory=100m ubuntu</code></p>
<h1 id="Docker-storage"><a class="header-anchor" href="#Docker-storage">¶</a>Docker storage</h1>
<p>We can view docker files at  <code>/var/lib/docker</code></p>
<p>Docker uses layered architecture</p>
<p><img src="https://raw.githubusercontent.com/q815101630/pic_storage/main/img/Untitled%203.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p>
<h2 id="COPY-ON-WRITE"><a class="header-anchor" href="#COPY-ON-WRITE">¶</a>COPY-ON-WRITE</h2>
<p>In the container layer, all files are writeable, however. Files on image layers are not writable. But we can copy them into the container layer and change them, but we need to rebuild the image then.</p>
<h2 id="Volume-Mounting"><a class="header-anchor" href="#Volume-Mounting">¶</a>Volume Mounting</h2>
<p>mount a piece of memory to a named volume, different containers can share this volume</p>
<h2 id="Bind-mounting"><a class="header-anchor" href="#Bind-mounting">¶</a>Bind mounting</h2>
<p>mount a folder location to a folder location in the container.</p>
<p><img src="https://raw.githubusercontent.com/q815101630/pic_storage/main/img/Untitled%204.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p>
<h1 id="Network"><a class="header-anchor" href="#Network">¶</a>Network</h1>
<ul>
<li><code>bridge</code> is the default network</li>
<li><code>none</code> is an isolated network</li>
<li><code>host</code> is a direct mapping with the host network</li>
<li><code>docker network create</code> create new user-defined network</li>
<li>Docker has DNS setting so that a container name is directly mapped with the container IP!</li>
</ul>
<p><img src="https://raw.githubusercontent.com/q815101630/pic_storage/main/img/Untitled%205.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p>
<h1 id="Orchestration"><a class="header-anchor" href="#Orchestration">¶</a>Orchestration</h1>
<p>A solution to host multiple containers at the same time.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">docker service create --replicas=<span class="hljs-number">100</span> nodejs<br></code></pre></td></tr></table></figure>
<ul>
<li>Docker Swarm</li>
<li>Kubernetes</li>
<li>Mesos</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/backend/">backend</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/docker/">docker</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/12/16/NestJs-Notes/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">NestJs-Notes</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/12/12/Nginx-Learning-Note/">
                        <span class="hidden-mobile">Nginx Learning Note</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="twikoo"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/twikoo@1/dist/twikoo.all.min.js', function() {
        var options = Object.assign(
          {"envId":"https://blog-comments-khaki.vercel.app/","region":"ap-shanghai","path":"window.location.pathname"},
          {
            el: '#twikoo',
            path: 'window.location.pathname',
            onCommentLoaded: function() {
              Fluid.plugins.initFancyBox('#twikoo .tk-content img:not(.tk-owo-emotion)');
            }
          }
        )
        twikoo.init(options)
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          <link rel="stylesheet" href="/music_player/APlayer.min.css"><div id="aplayer"></div><script type="text/javascript" src="/music_player/APlayer.min.js"></script><script type="text/javascript" src="/js/music_player.js"></script>
        </div>
      </div>
    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            
            <span id="busuanzi_value_site_pv"></span>
             views in total
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            
            <span id="busuanzi_value_site_uv"></span>
             people visited
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  











<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
